tinymce.PluginManager.add("filemanager",
function(e) {
    function n(t) {
        0 === e.settings.external_filemanager_path.toLowerCase().indexOf(t.origin.toLowerCase()) && "filemanager" === t.data.sender && (tinymce.activeEditor.insertContent(t.data.html), tinymce.activeEditor.windowManager.close(), window.removeEventListener ? window.removeEventListener("message", n, !1) : window.detachEvent("onmessage", n))
    }
    function t() {
        var width = window.innerWidth - 20,
        height = window.innerHeight - 40;
        if (width > 1800 && (width = 1800), width > 1200 && (height = 1200), width > 600) {
            var a = (width - 20) % 138;
            width = width - a + 10
        }
        e.focus(!0);
        var title = "FileManager";
        "undefined" != typeof e.settings.filemanager_title && e.settings.filemanager_title && (s = e.settings.filemanager_title);
        var key = "key";
        "undefined" != typeof e.settings.filemanager_access_key && e.settings.filemanager_access_key && (key = e.settings.filemanager_access_key);
        var sort = "";
        "undefined" != typeof e.settings.filemanager_sort_by && e.settings.filemanager_sort_by && (sort = "&sort_by=" + e.settings.filemanager_sort_by);
        var g = "false";
        "undefined" != typeof e.settings.filemanager_descending && e.settings.filemanager_descending && (g = e.settings.filemanager_descending);
        var path = "";
        "undefined" != typeof e.settings.filemanager_subfolder && e.settings.filemanager_subfolder && (path = "&fldr=" + e.settings.filemanager_subfolder);
        var l = "";
        "undefined" != typeof e.settings.filemanager_crossdomain && e.settings.filemanager_crossdomain && (l = "&crossdomain=1", window.addEventListener ? window.addEventListener("message", n, !1) : window.attachEvent("onmessage", n)),
        win = e.windowManager.open({
            title: title,
            file: e.settings.external_filemanager_path + "?type=all&descending=" + g + sort + path + l + "&akey=" + key,
            width: width,
            height: height,
            inline: 1,
            resizable: !0,
            maximizable: !0
        })
    }
    e.addButton("filemanager", {
        icon: "browse",
        tooltip: "Insert file",
        shortcut: "Ctrl+E",
        onclick: t
    }),
    e.addShortcut("Ctrl+E", "", t),
    e.addMenuItem("filemanager", {
        icon: "browse",
        text: "Insert file",
        shortcut: "Ctrl+E",
        onclick: t,
        context: "insert"
    })
});